<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Photo Organiser</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <style>
      img {max-width: 50%;}
      </style>
  </head>
  <body>
<form method="post" enctype="multipart/form-data">
  <div>
    <label for="image_uploads" id="initiallabel">Choose images to upload (PNG, JPG)</label>
    <input type="file" id="image_uploads" name="image_uploads" accept=".jpg, .jpeg, .png" multiple>
    <div><input type="text" id="category1" name="category1" placeholder="category 1"></div>
    <div><input type="text" id="category2" name="category2" placeholder="category 2"></div>
  </div>
  <div>
    <button id="next" type="button">Next</button>
  </div>
  <button id="cat1btn" type="button">Cat1</button>
  <button id="cat2btn" type="button">Cat2</button>
  <div class="preview">
    <p>No files currently selected for upload</p>
  </div>
</form>
</body>
<script>
var counter=0;
var done=false;
var cat1imgs = [];
var cat2imgs = [];
var input = document.querySelector('input');
var preview = document.querySelector('.preview');
var initialupload = document.getElementById('image_uploads');
var initiallabel = document.getElementById('initiallabel');
var nextb = document.getElementById('next');
var cat1 = document.getElementById('category1');
var cat2 = document.getElementById('category2');
var cat1btn = document.getElementById('cat1btn');
var cat2btn = document.getElementById('cat2btn');

cat1btn.style.display = "none";
cat2btn.style.display = "none";
//input.style.opacity = 0;
//input.addEventListener('change', updateImageDisplay);
nextb.addEventListener('click', updateImageDisplay);
cat1btn.addEventListener('click',
    function() {
        pickedcat(1);
    }
);
cat2btn.addEventListener('click',
    function() {
        pickedcat(2);
    }
);

function updateImageDisplay() {
  cat1btn.style.display = "inline";
  cat2btn.style.display = "inline";
  cat1.style.display = "none";
  cat2.style.display = "none";
  initialupload.style.display = "none";
  initiallabel.style.display = "none";
  nextb.style.display = "none";

  cat1btn.innerText = cat1.value;
  cat2btn.innerText = cat2.value;

  while(preview.firstChild) {
  preview.removeChild(preview.firstChild);
  }
  var curFiles = input.files;
  if (curFiles[counter]) {
    var image = document.createElement('img');
    image.src = window.URL.createObjectURL(curFiles[counter])
    preview.appendChild(image);
  } else {
    done = true;
    /*var done = document.createElement('p');
    var t = document.createTextNode("You are done");
    done.appendChild(t);
    preview.appendChild(done);*/
  }
}

function pickedcat(num) {
  if(!done){
    if (num==1){
      cat1imgs.push(input.files[counter]);
    }else if (num==2){
      cat2imgs.push(input.files[counter]);
    }
    counter++;
    updateImageDisplay();
  } else{
    if(num==1){
      var files = cat1imgs;
    } else{
      var files = cat2imgs;
    }
    while(preview.firstChild) {
    preview.removeChild(preview.firstChild);
    }
    var iter=0;
    while (files[iter]) {
      var image = document.createElement('img');
      image.src = window.URL.createObjectURL(files[iter]);
      preview.appendChild(image);
      iter++;
  }
}

}

</script>
